<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PAYTROLL — Dashboard</title>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.1/dist/jspdf.plugin.autotable.min.js"></script>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--panel:#0f172a;--panel2:#1e293b;--panel3:#334155;--border:rgba(255,255,255,.1)}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Inter',sans-serif;
      color:#fff; min-height:100vh; overflow-x:hidden;
      background:linear-gradient(135deg,#0f172a 0%,#1e293b 30%,#334155 100%);
    }

    .wrap{max-width:1280px; margin:24px auto 64px; --pad:24px; padding:0 var(--pad)}

    /* Header */
    .dashboard-header{
      position:relative; display:flex; align-items:center; justify-content:space-between;
      width:100vw; margin-left:calc(50% - 50vw); margin-right:calc(50% - 50vw);
      padding:0 24px 25px; gap:18px; margin-bottom:35px; border-bottom:1px solid transparent;
    }
    .dashboard-header::after{content:""; position:absolute; left:0; right:0; bottom:0; height:1px; background:var(--border)}
    .dashboard-logo{font-size:30px; font-weight:900; letter-spacing:1px}
    .dashboard-nav{display:flex; gap:24px; flex-wrap:wrap; align-items:flex-start; margin:0 auto}
    .dashboard-nav a{
      color:rgba(255,255,255,.7); text-decoration:none; font-size:15px; font-weight:500; position:relative; transition:.2s; padding:6px 2px
    }
    .dashboard-nav a:hover{color:#fff}
    .dashboard-nav a.active{color:#fff}
    .dashboard-nav a.active::after{content:''; position:absolute; bottom:-14px; left:0; right:0; height:2px; background:#3b82f6; border-radius:1px}

    .right-utils{display:flex; align-items:center; gap:10px; position:relative}

    /* Modern icon buttons */
    .icon-btn{
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15); color:#fff;
      padding:10px 12px; border-radius:12px; font-size:13px; font-weight:500; cursor:pointer; transition:.2s;
      display:inline-flex; align-items:center; gap:8px;
    }
    .icon-btn:hover{background:rgba(255,255,255,.15); transform:translateY(-1px)}
    .icon-btn.round{width:42px; height:42px; padding:0; border-radius:50%; display:grid; place-items:center}

    /* Notification */
    .notification{position:relative}
    .notification .dot{position:absolute; top:2px; right:2px; width:9px; height:9px; background:#ef4444; border-radius:50%; box-shadow:0 0 12px #ef4444; animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.25);opacity:.7}}

    .dropdown{position:absolute; right:0; top:48px; background:rgba(15,23,42,.96); border:1px solid var(--border);
      border-radius:12px; width:320px; display:none; z-index:20; box-shadow:0 18px 50px rgba(0,0,0,.5)}
    .dropdown h4{margin:10px 12px; font-size:12px; color:#cbd5e1}
    .dropdown .item{display:flex; gap:10px; padding:10px 12px; border-top:1px dashed rgba(255,255,255,.1)}
    .dropdown .item:first-of-type{border-top:0}
    .dropdown .muted{color:#9ca3af; font-size:12px}

    /* Profile avatar modern */
    .profile{position:relative}
    .profile .avatar{
      width:44px; height:44px; border-radius:50%;
      background:conic-gradient(from 180deg,#a78bfa,#60a5fa,#34d399,#f472b6,#a78bfa);
      padding:2px; display:grid; place-items:center; cursor:pointer; transition:.2s;
    }
    .profile .avatar-inner{
      width:100%; height:100%; border-radius:50%;
      background:linear-gradient(135deg,#1f2937,#0b1220); display:grid; place-items:center;
    }
    .profile .avatar svg{width:22px; height:22px; opacity:.9}
    .profile .avatar:hover{transform:translateY(-2px) scale(1.03); box-shadow:0 10px 26px rgba(0,0,0,.35)}

    .menu{position:absolute; right:0; top:52px; background:rgba(15,23,42,.96); border:1px solid var(--border);
      border-radius:12px; width:240px; display:none; z-index:20; overflow:hidden; box-shadow:0 18px 50px rgba(0,0,0,.5)}
    .menu a{display:flex; gap:10px; align-items:center; padding:10px 12px; color:#cbd5e1; text-decoration:none; font-size:14px}
    .menu a:hover{background:rgba(255,255,255,.06); color:#fff}

    /* Search palette */
    .search-wrap{position:relative}
    .palette{position:absolute; right:0; top:48px; width:360px; background:rgba(15,23,42,.98);
      border:1px solid var(--border); border-radius:12px; display:none; z-index:25; box-shadow:0 18px 50px rgba(0,0,0,.5)}
    .palette header{padding:10px 12px; border-bottom:1px solid var(--border); font-size:13px; color:#9ca3af}
    .palette .row{display:flex; align-items:center; gap:8px; padding:8px 10px}
    .palette input{width:100%; background:transparent; border:0; outline:0; color:#fff; padding:6px 8px}
    .results{max-height:260px; overflow:auto}
    .results a{display:flex; justify-content:space-between; gap:10px; text-decoration:none; color:#cbd5e1; padding:8px 12px}
    .results a:hover{background:#141a30; color:#fff}
    .badge{font-size:11px; color:#9ca3af}

    /* Welcome */
    .welcome-section{margin-bottom:20px; margin-left:0}
    .welcome-title{font-size:32px; font-weight:700; margin-bottom:6px}
    .welcome-subtitle{color:rgba(255,255,255,.7); font-size:16px}

    /* Wallet cards row */
    .stats-grid{
      display:grid; grid-template-columns:repeat(4, minmax(0,1fr));
      gap:26px; margin-bottom:16px;
    }
    .stat-card{
      background:rgba(255,255,255,.10); backdrop-filter:blur(24px);
      border:1px solid rgba(255,255,255,.14); border-radius:20px; padding:32px;
      transition:.2s; position:relative; overflow:hidden
    }
    .stat-card::before{content:''; position:absolute; top:0; left:0; right:0; height:1px;
      background:linear-gradient(90deg, transparent, rgba(255,255,255,.25), transparent)}
    .stat-card:hover{transform:translateY(-6px); background:rgba(255,255,255,.14); box-shadow:0 18px 48px rgba(0,0,0,.35)}
    .stat-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:18px}
    .currency-icon{
      width:60px; height:60px; border-radius:16px; display:flex; align-items:center; justify-content:center;
      font-size:26px; margin-bottom:20px; font-weight:900
    }
    .stat-card:nth-child(1) .currency-icon{background:rgba(34,197,94,.22); color:#22c55e}
    .stat-card:nth-child(2) .currency-icon{background:rgba(59,130,246,.22); color:#3b82f6}
    .stat-card:nth-child(3) .currency-icon{background:rgba(168,85,247,.22); color:#a855f7}
    .stat-card:nth-child(4) .currency-icon{background:rgba(245,158,11,.22); color:#f59e0b}
    .stat-title{color:rgba(255,255,255,.75); font-size:15px; font-weight:600; margin-bottom:2px}
    .stat-amount{font-size:36px; font-weight:800; letter-spacing:-.5px}
    .mom{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.08); color:#e5e7eb; white-space:nowrap}

    /* -------- Quick Actions -------- */
    .quick-actions{
      display:grid; grid-template-columns:repeat(4, minmax(0,1fr)); gap:16px; margin:20px 0 26px;
    }
    .qa-card{
      background:rgba(255,255,255,.10); backdrop-filter:blur(20px);
      border:1px solid rgba(255,255,255,.14); border-radius:16px; padding:16px 18px;
      display:flex; align-items:center; gap:12px; cursor:pointer; transition:.2s;
    }
    .qa-card:hover{transform:translateY(-4px); background:rgba(255,255,255,.14)}
    .qa-icon{
      width:42px; height:42px; border-radius:12px; display:grid; place-items:center;
      background:rgba(236,72,153,.10); border:1px solid rgba(236,72,153,.25); color:#fff;
    }
    .qa-icon svg{width:20px; height:20px; stroke:rgba(236,72,153,.95)}
    .qa-title{font-weight:700; font-size:14px; color:#fff}
    .qa-sub{font-size:12px; color:#cbd5e1}

    /* Recent beneficiaries */
    .benef-row{
      display:flex; gap:14px; overflow:auto; padding:4px 2px 8px;
      scrollbar-width:thin; scrollbar-color:rgba(255,255,255,.2) transparent;
      margin-bottom:26px;
    }
    .benef{
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.14);
      padding:10px 12px; border-radius:12px; display:flex; align-items:center; gap:10px; white-space:nowrap;
    }
    .benef .av{width:28px; height:28px; border-radius:50%; display:grid; place-items:center; font-size:13px;
      background:rgba(236,72,153,.10); border:1px solid rgba(236,72,153,.25); color:#fff}
    .benef .name{font-size:13px}
    .benef .again{font-size:12px; color:#9ca3af}

    /* Analytics + Transactions layout */
    .grid-2{
      display:grid; grid-template-columns:1.1fr 1.4fr; gap:26px;
    }
    .card{
      background:rgba(255,255,255,.10); backdrop-filter:blur(24px);
      border:1px solid rgba(255,255,255,.14); border-radius:20px; padding:22px;
      position:relative; overflow:hidden;
    }
    .card h3{font-size:16px; font-weight:700; margin-bottom:6px}
    .subtle{color:rgba(255,255,255,.75); font-size:12px}
    .card-toolbar{display:flex; gap:10px; align-items:center; justify-content:space-between; margin-bottom:10px}
    .chip{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.08); color:#e5e7eb}

    .chart-wrap{height:260px; position:relative; margin-top:6px}
    canvas{width:100%; height:100%}
    .donut-wrap{height:180px; margin-top:10px}

    /* Transactions */
    .table-toolbar{display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:12px}
    .search-input{
      width:260px; max-width:60vw; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15);
      color:#fff; padding:10px 12px; border-radius:12px; outline:none;
    }
    .save-filter{background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15); color:#fff; padding:8px 12px; border-radius:10px; cursor:pointer}
    .saved-tags{display:flex; gap:8px; flex-wrap:wrap; margin-top:6px}
    .tag{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.08)}
    table{width:100%; border-collapse:separate; border-spacing:0 10px}
    thead th{font-size:12px; color:#cbd5e1; text-align:left; padding:0 10px}
    tbody tr{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12)}
    tbody tr td{padding:12px 10px; font-size:14px}
    tbody tr{border-radius:12px; overflow:hidden}
    tbody tr td:first-child{border-top-left-radius:12px; border-bottom-left-radius:12px}
    tbody tr td:last-child{border-top-right-radius:12px; border-bottom-right-radius:12px}
    .amount-pos{color:#34d399; font-weight:700}
    .amount-neg{color:#f87171; font-weight:700}
    .badge{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.08); color:#e5e7eb; white-space:nowrap}
    .pager{display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-top:12px}
    .pager button{
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15); color:#fff;
      padding:8px 12px; border-radius:10px; cursor:pointer;
    }
    .pager .muted{color:#9ca3af; font-size:12px}

    /* Overlay */
    .overlay{
      position:fixed; inset:0; display:none; place-items:center; z-index:60;
      background:rgba(10,12,20,.45); backdrop-filter:blur(8px); animation:fadeIn .15s ease-out;
    }
    .overlay .grid{
      width:min(1040px,92vw);
      display:grid; grid-template-columns:repeat(4,1fr); gap:20px;
      transform:translateY(8px); animation:floatUp .2s ease-out forwards;
    }
    .overlay .stat-card{cursor:pointer}
    .overlay .close{
      position:absolute; top:18px; right:22px; background:rgba(255,255,255,.1);
      border:1px solid var(--border); color:#fff; padding:8px 12px; border-radius:10px; cursor:pointer;
    }

    /* Floating forms (same glass look) */
    .sheet{position:fixed; inset:0; display:none; place-items:center; z-index:70;
      background:rgba(10,12,20,.45); backdrop-filter:blur(8px); animation:fadeIn .15s ease-out;}
    .sheet .panel{
      width:min(640px,94vw);
      background:rgba(255,255,255,.10); backdrop-filter:blur(24px);
      border:1px solid rgba(255,255,255,.14); border-radius:20px; padding:16px;
      transform:translateY(8px); animation:floatUp .2s ease-out forwards; position:relative;
    }
    .sheet h3{font-size:18px; font-weight:800; margin-bottom:6px}
    .sheet .subtle{margin-bottom:14px}
    .sheet .row{display:flex; flex-direction:column; gap:6px; margin-bottom:12px}
    .sheet label{font-size:12px; color:#cbd5e1}
    .sheet input,.sheet select,.sheet textarea{
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15);
      color:#fff; padding:10px 12px; border-radius:12px; outline:none; font-size:14px;
    }
    .sheet textarea{min-height:80px; resize:vertical}
    .sheet .actions{display:flex; justify-content:flex-end; gap:8px; margin-top:6px}
    .btn{
      background:rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.2); color:#fff;
      padding:10px 14px; border-radius:12px; cursor:pointer; transition:.2s; font-weight:600
    }
    .btn:hover{background:rgba(255,255,255,.16)}
    .btn.primary{border-color:#3b82f6; background:rgba(59,130,246,.15)}
    .sheet .x{position:absolute; right:14px; top:14px; background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.2); border-radius:10px; padding:6px 9px; cursor:pointer}

    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes floatUp{to{transform:translateY(0)}}

    @media(max-width:1200px){ .grid-2{grid-template-columns:1fr} .chart-wrap{height:240px} }
    @media(max-width:1024px){
      .stats-grid{grid-template-columns:repeat(2,minmax(0,1fr))}
      .quick-actions{grid-template-columns:repeat(2,minmax(0,1fr))}
      .overlay .grid{grid-template-columns:repeat(2,1fr)}
    }
    @media(max-width:768px){
      .stats-grid{grid-template-columns:1fr}
      .quick-actions{grid-template-columns:1fr}
      .wrap{padding:0 16px}
      .palette{width:92vw}
      .overlay .grid{grid-template-columns:1fr}
      .welcome-section{margin-left:0}
      .search-input{width:100%}
    }
    /* Accessibility: respect reduced motion */
@media (prefers-reduced-motion: reduce){
  *{ animation:none !important; transition:none !important }
  .notification .dot{ animation:none !important }
}
/* Horizontal bank form layout */
#wd-bank-fields{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px 14px;
  align-items:start;
}
#wd-bank-fields .row{ margin-bottom:0 } 

#wd-bank-fields .row--full{ grid-column:1 / -1 }

@media (max-width:640px){
  #wd-bank-fields{ grid-template-columns:1fr }
}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="dashboard-header">
      <div class="dashboard-logo">PAYTROLL</div>

      <nav class="dashboard-nav" aria-label="Primary">
        <a href="overview.html" id="navOverview" class="active">Overview</a>
        <a href="wallet.html" id="navWallet">Wallet</a>
        <a href="transactions.html" id="navTx">Transactions</a>
        <a href="statistics.html" id="navStats">Statistics</a>
      </nav>

      <div class="right-utils">
        <div class="search-wrap">
          <button id="searchBtn" class="icon-btn round" title="Search" aria-label="Search">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <circle cx="11" cy="11" r="7"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
          </button>
          <div id="palette" class="palette" role="dialog" aria-label="Search">
            <header>Search dashboard</header>
            <div class="row" style="padding:10px 12px">
              <input id="searchInput" type="search" placeholder="Type to search sections and actions"/>
            </div>
            <div id="results" class="results"></div>
          </div>
        </div>

        <button id="download" class="icon-btn" title="Download monthly report">Download Report</button>

        <div class="notification">
          <button id="notifBtn" class="icon-btn round" title="Notifications" aria-label="Notifications">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M18 8a6 6 0 1 0-12 0c0 7-3 7-3 9h18c0-2-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
          </button>
          <span class="dot"></span>
          <div id="notifMenu" class="dropdown" role="menu" aria-label="Notifications">
            <h4>Notifications</h4>
            <div class="item"><div>📬</div><div><b>Deposit received</b><div class="muted">USD 250.00 credited</div></div></div>
            <div class="item"><div>⚠️</div><div><b>Security alert</b><div class="muted">New device login</div></div></div>
            <div class="item"><div>📊</div><div><b>Monthly statement</b><div class="muted">Ready to download</div></div></div>
            <div class="item"><div>💬</div><div><b>Support reply</b><div class="muted">Ticket #18324 updated</div></div></div>
          </div>
        </div>

        <div class="profile">
          <div id="avatar" class="avatar" title="Profile" aria-label="Profile">
            <div class="avatar-inner">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M20 21a8 8 0 0 0-16 0"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </div>
          </div>
          <nav id="profileMenu" class="menu" aria-label="Profile">
            <div style="padding:10px 12px; font-size:13px; color:#cbd5e1; border-bottom:1px solid rgba(255,255,255,.08)">
              ID: <b id="userIdValue">—</b>
            </div>

            <a href="profile.html">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="opacity:.8">
                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              View profile
            </a>
            <a href="settings.html">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="opacity:.8">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V22a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 8 20.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 3.4 15 1.65 1.65 0 0 0 2 14h-.09a2 2 0 1 1 0-4H2c.73 0 1.38-.4 1.73-1a1.65 1.65 0 0 0-.33-1.82l-.06-.06A2 2 0 1 1 6.17 2.2l.06.06A1.65 1.65 0 0 0 8 2h.09a2 2 0 1 1 4 0V2c0 .63.37 1.19.94 1.46.57.27 1.25.17 1.7-.28l.06-.06A2 2 0 1 1 19.4 6.17l-.06.06c-.45 .45-.55 1.13-.28 1.7.27.57.83.94 1.46.94H22a2 2 0 1 1 0 4h-.09c-.63 0-1.19.37-1.46.94Z"></path>
              </svg>
              Settings
            </a>

            <a href="kyc.html" id="menuKyc">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="opacity:.85">
                <rect x="3" y="4" width="18" height="14" rx="2"></rect>
                <path d="M7 8h5"></path><path d="M7 12h7"></path>
                <circle cx="17" cy="9.5" r="1.5"></circle>
              </svg>
              KYC verification
            </a>
            <div id="kycFlag" style="padding:6px 12px; font-size:12px; color:#9ca3af">Status: unknown</div>

            <a href="customer-service.html">🎧 Customer service</a>
            <a href="help-centre.html">❓ Help centre</a>
            <a href="logout.html">🔒 Logout</a>
          </nav>
        </div>
      </div>
    </header>

    <main>
      <section class="welcome-section">
        <h2 class="welcome-title">Welcome Back, User!</h2>
        <p class="welcome-subtitle">Insights at a glance: empowering your financial journey.</p>
      </section>

      <!-- Wallet cards -->
      <section class="stats-grid" id="walletBoxes">
        <div class="stat-card" data-wallet="USD" data-mom="+3.2%">
          <div class="currency-icon">$</div>
          <div class="stat-header">
            <div><div class="stat-title">USD Balance</div></div>
            <div class="mom" id="mom-usd">+3.2% MoM</div>
          </div>
          <div class="stat-amount" id="amt-usd">$8,326.25</div>
        </div>
        <div class="stat-card" data-wallet="EUR" data-mom="+1.8%">
          <div class="currency-icon">€</div>
          <div class="stat-header">
            <div><div class="stat-title">EUR Balance</div></div>
            <div class="mom" id="mom-eur">+1.8% MoM</div>
          </div>
          <div class="stat-amount" id="amt-eur">€7,156.00</div>
        </div>
        <div class="stat-card" data-wallet="GBP" data-mom="-0.6%">
          <div class="currency-icon">£</div>
          <div class="stat-header">
            <div><div class="stat-title">GBP Balance</div></div>
            <div class="mom" id="mom-gbp">-0.6% MoM</div>
          </div>
          <div class="stat-amount" id="amt-gbp">£4,268.40</div>
        </div>
        <div class="stat-card" data-wallet="SAR" data-mom="+0.9%">
          <div class="currency-icon">﷼</div>
          <div class="stat-header">
            <div><div class="stat-title">SAR Balance</div></div>
            <div class="mom" id="mom-sar">+0.9% MoM</div>
          </div>
          <div class="stat-amount" id="amt-sar">﷼6,197.00</div>
        </div>
      </section>

      <!-- Quick Actions -->
      <section class="quick-actions" aria-label="Quick actions">
        <button class="qa-card" id="qaSend" aria-label="Send Money">
          <div class="qa-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round">
              <path d="M5 12h14"></path>
              <path d="M12 5l7 7-7 7"></path>
            </svg>
          </div>
          <div>
            <div class="qa-title">Send Money</div>
            <div class="qa-sub">Transfer to anyone</div>
          </div>
        </button>

        <button class="qa-card" id="qaWithdraw" aria-label="Withdraw">
          <div class="qa-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="4" width="20" height="6" rx="2"></rect>
              <path d="M12 20V10"></path>
              <path d="M8 16l4 4 4-4"></path>
            </svg>
          </div>
          <div>
            <div class="qa-title">Withdraw</div>
            <div class="qa-sub">To bank or card</div>
          </div>
        </button>

        <button class="qa-card" id="qaRequest" aria-label="Request Money">
          <div class="qa-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round">
              <path d="M5 12h14"></path>
              <path d="M12 19l-7-7 7-7"></path>
            </svg>
          </div>
          <div>
            <div class="qa-title">Request Money</div>
            <div class="qa-sub">Ask a contact</div>
          </div>
        </button>

        <button class="qa-card" id="qaAdd" aria-label="Add Money">
          <div class="qa-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="5" width="18" height="14" rx="2"></rect>
              <path d="M12 9v6"></path>
              <path d="M9 12h6"></path>
            </svg>
          </div>
          <div>
            <div class="qa-title">Add Money</div>
            <div class="qa-sub">Top up instantly</div>
          </div>
        </button>
      </section>

      <!-- Recent beneficiaries -->
      <div class="benef-row" id="benefRow" aria-label="Recent beneficiaries"></div>

      <!-- Analytics + Transactions -->
      <section class="grid-2">
        <div class="card">
          <div class="card-toolbar">
            <div>
              <h3>Spending — last 6 months</h3>
              <div class="subtle">All wallets combined</div>
            </div>
            <div style="display:flex; gap:8px; align-items:center">
              <span class="chip" id="fxChip">1 USD = 0.91 EUR</span>
              <select id="ccy" class="chip" style="background:transparent; outline:none; cursor:pointer">
                <option value="USD">Base: USD</option>
                <option value="EUR">Base: EUR</option>
                <option value="GBP">Base: GBP</option>
                <option value="SAR">Base: SAR</option>
              </select>
            </div>
          </div>
          <div class="chart-wrap"><canvas id="spendChart" width="600" height="260"></canvas></div>
          <div class="donut-wrap"><canvas id="donutChart" width="600" height="180"></canvas></div>
        </div>

        <div class="card">
          <div class="table-toolbar">
            <div>
              <h3>Recent Transactions</h3>
              <div class="subtle" id="txCountLabel">0 items</div>
              <div class="saved-tags" id="savedTags"></div>
            </div>
            <div style="display:flex; gap:8px; align-items:center">
              <input id="txSearch" class="search-input" type="search" placeholder="Search description or status"/>
              <button id="saveFilter" class="save-filter">Save filter</button>
            </div>
          </div>

          <table aria-label="Recent transactions">
            <thead>
              <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Wallet</th>
                <th>Amount</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="txBody"></tbody>
          </table>

          <div class="pager">
            <span class="muted" id="pageInfo"></span>
            <button id="prevPage" disabled>Prev</button>
            <button id="nextPage" disabled>Next</button>
          </div>
        </div>
      </section>

      <!-- === NEW: Deposit & Withdraw History (same design) === -->
      <section class="grid-2" style="margin-top:26px">
        <!-- Deposit History -->
        <div class="card">
          <div class="table-toolbar">
            <div>
              <h3>Deposit History</h3>
              <div class="subtle" id="depCountLabel">0 items</div>
            </div>
            <input id="depSearch" class="search-input" type="search" placeholder="Search reference or status"/>
          </div>

          <table aria-label="Deposit history">
            <thead>
              <tr>
                <th>Date</th>
                <th>Reference</th>
                <th>Wallet</th>
                <th>Amount</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="depBody"></tbody>
          </table>

          <div class="pager">
            <span class="muted" id="depPageInfo"></span>
            <button id="depPrev" disabled>Prev</button>
            <button id="depNext" disabled>Next</button>
          </div>
        </div>

        <!-- Withdraw History -->
        <div class="card">
          <div class="table-toolbar">
            <div>
              <h3>Withdraw History</h3>
              <div class="subtle" id="wdCountLabel">0 items</div>
            </div>
            <input id="wdSearch" class="search-input" type="search" placeholder="Search destination or status"/>
          </div>

          <table aria-label="Withdraw history">
            <thead>
              <tr>
                <th>Date</th>
                <th>Destination</th>
                <th>Wallet</th>
                <th>Amount</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="wdBody"></tbody>
          </table>

          <div class="pager">
            <span class="muted" id="wdPageInfo"></span>
            <button id="wdPrev" disabled>Prev</button>
            <button id="wdNext" disabled>Next</button>
          </div>
        </div>
      </section>
      <!-- === /NEW === -->
    </main>
  </div>

  <!-- Wallet overlay -->
  <div id="walletOverlay" class="overlay" aria-modal="true" role="dialog">
    <button class="close" id="overlayClose">Close ✕</button>
    <div class="grid">
      <div class="stat-card">
        <div class="currency-icon">$</div>
        <div class="stat-header"><div><div class="stat-title">USD Balance</div></div><div class="mom">+3.2% MoM</div></div>
        <div class="stat-amount">$8,326.25</div>
      </div>
      <div class="stat-card">
        <div class="currency-icon">€</div>
        <div class="stat-header"><div><div class="stat-title">EUR Balance</div></div><div class="mom">+1.8% MoM</div></div>
        <div class="stat-amount">€7,156.00</div>
      </div>
      <div class="stat-card">
        <div class="currency-icon">£</div>
        <div class="stat-header"><div><div class="stat-title">GBP Balance</div></div><div class="mom">-0.6% MoM</div></div>
        <div class="stat-amount">£4,268.40</div>
      </div>
      <div class="stat-card">
        <div class="currency-icon">﷼</div>
        <div class="stat-header"><div><div class="stat-title">SAR Balance</div></div><div class="mom">+0.9% MoM</div></div>
        <div class="stat-amount">﷼6,197.00</div>
      </div>
    </div>
  </div>

  <!-- ==== Floating Forms ==== -->
  <!-- Send -->
  <div id="sheet-send" class="sheet" aria-modal="true" role="dialog">
    <div class="panel" role="document">
      <button class="x" data-close="sheet-send">✕</button>
      <h3>Send Money</h3>
      <div class="subtle">Transfer securely to a PAYTROLL user</div>

      <div class="row">
        <label for="send-rec">Receiver ID Number</label>
        <input id="send-rec" type="text" placeholder="e.g. 9876543210" autocomplete="off">
      </div>
      <div class="row">
        <label for="send-amt">Amount</label>
        <input id="send-amt" type="number" step="0.01" placeholder="0.00">
      </div>
      <div class="row">
        <label for="send-ccy">Currency</label>
        <select id="send-ccy">
          <option>USD</option><option>EUR</option><option>GBP</option><option>SAR</option>
        </select>
      </div>
      <div class="row">
        <label for="send-note">Note (optional)</label>
        <textarea id="send-note" placeholder="Add a note (optional)"></textarea>
      </div>

      <div class="row" id="send-fee-wrap">
        <div class="subtle" id="send-fee-line">Fees: — | Receiver gets: —</div>
      </div>

      <div class="actions">
        <button class="btn" data-close="sheet-send">Cancel</button>
        <button class="btn primary" id="send-submit">Send Money</button>
      </div>
    </div>
  </div>

  <!-- Withdraw -->
  <div id="sheet-withdraw" class="sheet" aria-modal="true" role="dialog">
    <div class="panel" role="document">
      <button class="x" data-close="sheet-withdraw">✕</button>
      <h3>Withdraw</h3>
      <div class="subtle">Move funds to your bank or card</div>

      <div class="row">
        <label for="wd-method">Withdraw method</label>
        <select id="wd-method">
          <option value="bank">Withdraw to Bank</option>
          <option value="mfs">Withdraw to MFS (Mobile Money)</option>
        </select>
      </div>

      <div id="wd-bank-fields">
        <div class="row">
          <label for="wd-country">Country</label>
          <select id="wd-country"></select>
        </div>
        <div class="row">
          <label for="wd-city">City</label>
          <select id="wd-city"></select>
        </div>
      
        <div class="row">
          <label for="wd-bank">Bank name</label>
          <select id="wd-bank"></select>
        </div>
        <div class="row">
          <label for="wd-branch">Bank branch name</label>
          <input id="wd-branch" type="text" placeholder="e.g. Gulshan Branch">
        </div>
      
        <div class="row">
          <label for="wd-acno">Bank account number</label>
          <input id="wd-acno" type="text" placeholder="e.g. 0123456789">
        </div>
        <div class="row">
          <label for="wd-acname">Bank account owner name</label>
          <input id="wd-acname" type="text" placeholder="e.g. John Doe">
        </div>
      
        <div class="row row--full">
          <label for="wd-address">Bank full address</label>
          <input id="wd-address" type="text" placeholder="Street, City, ZIP">
        </div>
      </div>

      <div id="wd-mfs-fields" style="display:none">
        <div class="row">
          <label for="wd-mfs">MFS provider</label>
          <select id="wd-mfs"></select>
        </div>
        <div class="row">
          <label for="wd-mfs-number">Mobile wallet number</label>
          <input id="wd-mfs-number" type="text" placeholder="e.g. +8801XXXXXXXXX">
        </div>
        <div class="row">
          <label for="wd-mfs-name">Account owner name</label>
          <input id="wd-mfs-name" type="text" placeholder="e.g. John Doe">
        </div>
      </div>

      <div class="row">
        <label for="wd-amt">Amount</label>
        <input id="wd-amt" type="number" step="0.01" placeholder="0.00">
      </div>
      <div class="row">
        <label for="wd-ccy">Currency</label>
        <select id="wd-ccy">
          <option>USD</option><option>EUR</option><option>GBP</option><option>SAR</option>
        </select>
      </div>

      <div class="row" id="wd-fee-wrap">
        <div class="subtle" id="wd-fee-line">Fees: — | You’ll receive: —</div>
      </div>

      <div class="actions">
        <button class="btn" data-close="sheet-withdraw">Cancel</button>
        <button class="btn primary" id="wd-submit">Withdraw</button>
      </div>
    </div>
  </div>

  <!-- Request -->
  <div id="sheet-request" class="sheet" aria-modal="true" role="dialog">
    <div class="panel" role="document">
      <button class="x" data-close="sheet-request">✕</button>
      <h3>Request Money</h3>
      <div class="subtle">Ask a contact to send you funds</div>

      <div class="row">
        <label for="rq-rec">ID Number</label>
        <input id="rq-rec" type="text" placeholder="e.g. 9876543210" autocomplete="off">
      </div>
      <div class="row">
        <label for="rq-amt">Amount</label>
        <input id="rq-amt" type="number" step="0.01" placeholder="0.00">
      </div>
      <div class="row">
        <label for="rq-ccy">Currency</label>
        <select id="rq-ccy">
          <option>USD</option><option>EUR</option><option>GBP</option><option>SAR</option>
        </select>
      </div>

      <div class="row"><div class="subtle">Fees: 0 — Request is free</div></div>

      <div class="actions">
        <button class="btn" data-close="sheet-request">Cancel</button>
        <button class="btn primary" id="rq-submit">Request</button>
      </div>
    </div>
  </div>

  <!-- Add -->
  <div id="sheet-add" class="sheet" aria-modal="true" role="dialog">
    <div class="panel" role="document">
      <button class="x" data-close="sheet-add">✕</button>
      <h3>Add Money</h3>
      <div class="subtle">Top up your wallet instantly</div>

      <div class="row">
        <label for="ad-amt">Amount</label>
        <input id="ad-amt" type="number" step="0.01" placeholder="0.00">
      </div>
      <div class="row">
        <label for="ad-ccy">Currency</label>
        <select id="ad-ccy">
          <option>USD</option><option>EUR</option><option>GBP</option><option>SAR</option>
        </select>
      </div>

      <div class="row">
        <label for="card-number">Card number</label>
        <input id="card-number" inputmode="numeric" placeholder="•••• •••• •••• ••••" maxlength="19">
      </div>
      <div class="row">
        <label for="card-name">Name on card</label>
        <input id="card-name" type="text" placeholder="As printed on card">
      </div>
      <div class="row" style="display:flex; gap:8px">
        <div style="flex:1">
          <label for="card-exp">Expiry (MM/YY)</label>
          <input id="card-exp" placeholder="MM/YY" maxlength="5">
        </div>
        <div style="flex:1">
          <label for="card-cvv">CVV</label>
          <input id="card-cvv" inputmode="numeric" placeholder="●●●" maxlength="4">
        </div>
      </div>
      <div class="row" style="display:flex; gap:8px">
        <div style="flex:1">
          <label for="bill-country">Billing country</label>
          <input id="bill-country" type="text" placeholder="e.g. Bangladesh">
        </div>
        <div style="flex:1">
          <label for="bill-zip">ZIP / Postal code</label>
          <input id="bill-zip" type="text" placeholder="e.g. 1212">
        </div>
      </div>

      <div class="row"><div class="subtle">Fees: 0 — Add Money is free</div></div>

      <div class="actions">
        <button class="btn" data-close="sheet-add">Cancel</button>
        <button class="btn primary" id="ad-submit">Add Money</button>
      </div>
    </div>
  </div>
  <!-- ==== /Floating Forms ==== -->

  <script>
    /* Notifications dropdown */
    const notifBtn=document.getElementById('notifBtn');
    const notifMenu=document.getElementById('notifMenu');
    if(notifBtn && notifMenu){
      notifBtn.addEventListener('click', (e)=> {
        e.stopPropagation();
        notifMenu.style.display = notifMenu.style.display==='block'?'none':'block';
        const dot = document.querySelector('.notification .dot');
        if(dot) dot.style.display='none';
      });
      document.addEventListener('click',e=>{
        if(!notifMenu.contains(e.target) && e.target!==notifBtn){ notifMenu.style.display='none'; }
      });
    }

    /* Profile dropdown */
    const avatar=document.getElementById('avatar');
    const profileMenu=document.getElementById('profileMenu');
    if(avatar && profileMenu){
      avatar.addEventListener('click',(e)=>{ 
        e.stopPropagation();
        profileMenu.style.display = profileMenu.style.display==='block'?'none':'block'; 
      });
      document.addEventListener('click',e=>{
        if(!profileMenu.contains(e.target) && e.target!==avatar){ profileMenu.style.display='none'; }
      });
    }

    /* KYC badge */
    const KYC_KEY = 'kycStatus';
    const kycFlag = document.getElementById('kycFlag');
    function getKyc(){ return localStorage.getItem(KYC_KEY) || 'unverified'; }
    function renderKyc(){
      const s = getKyc();
      if(!kycFlag) return;
      let label = '❌ KYC not verified';
      if(s==='pending') label = '⏳ KYC under review';
      if(s==='verified') label = '✅ KYC verified';
      kycFlag.innerHTML = `<span class="badge">${label}</span>`;
    }
    renderKyc();

    function pushNotif(title, sub, extras={}){
      if(!notifMenu) return;
      const item = document.createElement('div');
      item.className = 'item';
      const data = extras.action ? ` data-action="${extras.action}" data-requester="${extras.requesterId||''}"` : '';
      item.innerHTML = `<div${data}>🔔</div><div${data}><b>${title}</b><div class="muted">${sub}</div></div>`;
      notifMenu.prepend(item);
      const dot = document.querySelector('.notification .dot');
      if(dot) dot.style.display='block';
    }

    (function scheduleKycOnce(){
  try{
    const FLAG_KEY = 'kycNotifShown';
    if(getKyc()!=='verified' && !localStorage.getItem(FLAG_KEY)){
      pushNotif('KYC required', 'Please complete verification');
      localStorage.setItem(FLAG_KEY, '1'); 
    }
  }catch(_){}
})();

    notifMenu?.addEventListener('click', (e)=>{
      const tgt = e.target.closest('[data-action]');
      if(!tgt) return;
      const action = tgt.getAttribute('data-action');
      if(action==='open-send'){
        const requester = tgt.getAttribute('data-requester')||'';
        openSheet('sheet-send');
        const inp = document.getElementById('send-rec');
        if(inp) inp.value = requester;
      }
    });

    /* Search palette */
    const searchBtn=document.getElementById('searchBtn');
    const palette=document.getElementById('palette');
    const searchInput=document.getElementById('searchInput');
    const results=document.getElementById('results');

    const index=[
      {label:'Overview', href:'overview.html', type:'Section'},
      {label:'Wallet', href:'wallet.html', type:'Section'},
      {label:'Transactions', href:'transactions.html', type:'Section'},
      {label:'Statistics', href:'statistics.html', type:'Section'},
      {label:'View profile', href:'profile.html', type:'Action'},
      {label:'Settings', href:'settings.html', type:'Action'},
      {label:'KYC verification', href:'kyc.html', type:'Action'},
      {label:'Send money', href:'#send-money', type:'Action'},
      {label:'Withdraw', href:'#withdraw', type:'Action'},
      {label:'Request money', href:'#request-money', type:'Action'},
      {label:'Add money', href:'#add-money', type:'Action'},
      {label:'Customer service', href:'customer-service.html', type:'Action'},
      {label:'Help centre', href:'help-centre.html', type:'Action'},
      {label:'Download report', href:'#download', type:'Action'}
    ];

    function openPalette(){
      if(!palette) return;
      palette.style.display='block';
      setTimeout(()=>searchInput && searchInput.focus(),0);
      renderResults('');
    }
    function closePalette(){ if(palette){ palette.style.display='none'; results.innerHTML=''; if(searchInput) searchInput.value=''; } }

    function renderResults(q){
      if(!results) return;
      const ql=q.toLowerCase();
      const hits=index.filter(i=>i.label.toLowerCase().includes(ql));
      results.innerHTML = hits.map(h=>`<a href="${h.href}" data-href="${h.href}">
        <span>${h.label}</span><span class="badge">${h.type}</span></a>`).join('') || `<div style="padding:10px 12px; color:#9ca3af">No results</div>`;
    }

    if(searchBtn){
      searchBtn.addEventListener('click',(e)=>{
        e.stopPropagation();
        palette.style.display==='block'?closePalette():openPalette();
      });
    }
    searchInput && searchInput.addEventListener('input',()=>renderResults(searchInput.value));
    results && results.addEventListener('click',e=>{
      const a=e.target.closest('a'); if(!a) return;
      const href = a.dataset.href;
      if(href==='#download'){ e.preventDefault(); closePalette(); generatePDF(); return; }
      if(['#send-money','#withdraw','#request-money','#add-money'].includes(href)){
        e.preventDefault(); closePalette();
        if(href==='#send-money') openSheet('sheet-send');
        if(href==='#withdraw') openSheet('sheet-withdraw');
        if(href==='#request-money') openSheet('sheet-request');
        if(href==='#add-money') openSheet('sheet-add');
        return;
      }
    });
    document.addEventListener('keydown',e=>{
      if(e.key==='Escape'){ closePalette(); closeAllSheets(); }
      if(e.key==='k' && (e.ctrlKey||e.metaKey)){ e.preventDefault(); openPalette(); }
      if(e.key==='Enter'){
        const el=document.activeElement;
        if(el && el.classList && el.classList.contains('qa-card')) el.click();
      }
    });
    document.addEventListener('click',e=>{
      if(palette && !palette.contains(e.target) && e.target!==searchBtn){ closePalette(); }
    });

    /* Monthly report PDF */
    function monthName(dt){ return dt.toLocaleString('en-US',{month:'long'}); }
    function generatePDF(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({orientation:'p', unit:'pt'});
      const now = new Date();
      const title = `PAYTROLL — ${monthName(now)} ${now.getFullYear()} Summary`;
      doc.setFontSize(16); doc.text(title, 40, 42);

      const rows=[...document.querySelectorAll('#walletBoxes .stat-card')].map(card=>{
        const label = card.querySelector('.stat-title').textContent.trim().replace(' Balance','');
        const amount = card.querySelector('.stat-amount').textContent.trim();
        return [label, amount];
      });

      doc.autoTable({ head:[['Wallet','Amount']], body:rows, startY:60, styles:{fontSize:11} });
      doc.save(`paytroll-${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-report.pdf`);
    }
    const downloadBtn=document.getElementById('download');
    downloadBtn && downloadBtn.addEventListener('click', generatePDF);

    /* Overview click => refresh */
    const navOverview=document.getElementById('navOverview');
    navOverview && navOverview.addEventListener('click', function(e){
      e.preventDefault(); location.reload();
    });

    /* Wallet overlay */
    const walletLink=document.getElementById('navWallet');
    const overlay=document.getElementById('walletOverlay');
    const overlayClose=document.getElementById('overlayClose');

    if(walletLink && overlay && overlayClose){
      walletLink.addEventListener('click', function(e){
        e.preventDefault();
        overlay.style.display='grid';
        document.body.style.overflow='hidden';
      });
      overlayClose.addEventListener('click', ()=>{
        overlay.style.display='none';
        document.body.style.overflow='';
      });
      overlay.addEventListener('click', (e)=>{
        if(e.target===overlay){ overlay.style.display='none'; document.body.style.overflow=''; }
      });
    }

    /* FX + currency switch */
    const rates = {
      USD: {USD:1,   EUR:0.91, GBP:0.78, SAR:3.75},
      EUR: {USD:1.10, EUR:1,   GBP:0.86, SAR:4.13},
      GBP: {USD:1.28, EUR:1.16, GBP:1,   SAR:4.77},
      SAR: {USD:0.27, EUR:0.24, GBP:0.21, SAR:1}
    };
    const ccySel = document.getElementById('ccy');
    const fxChip = document.getElementById('fxChip');

    function updateWalletDisplays(base){
      const sample = (base==='USD') ? 'EUR' : 'USD';
      fxChip.textContent = `1 ${base} = ${rates[base][sample]} ${sample}`;
    }

    ccySel && ccySel.addEventListener('change', ()=>{
      updateWalletDisplays(ccySel.value);
      drawLineChart(months, scaleSeries(seriesBase, ccySel.value));
      drawDonut(donutDataBase, ccySel.value);
    });

    /* Spending line chart (canvas) */
    const chartCanvas = document.getElementById('spendChart');
    const ctx = chartCanvas.getContext('2d');

    const months = (() => {
      const formatter = new Intl.DateTimeFormat('en', { month:'short' });
      const arr=[]; const d=new Date();
      for(let i=5;i>=0;i--){
        const dd=new Date(d.getFullYear(), d.getMonth()-i, 1);
        arr.push(formatter.format(dd));
      }
      return arr;
    })();
    const seriesBase = [820, 760, 910, 680, 1020, 890];
    function scaleSeries(values, base){
      const factor = rates['USD'][base] || 1;
      return values.map(v => Math.round(v * factor));
    }
    function drawLineChart(labels, values){
      const pad = { left:56, right:16, top:18, bottom:28 };
const dpr = window.devicePixelRatio || 1;
const cssW = chartCanvas.clientWidth || 600;
const cssH = chartCanvas.clientHeight || 260;
chartCanvas.width  = Math.round(cssW * dpr);
chartCanvas.height = Math.round(cssH * dpr);
chartCanvas.style.width  = cssW + 'px';
chartCanvas.style.height = cssH + 'px';
ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
ctx.clearRect(0,0,cssW,cssH);
const w = cssW, h = cssH;

      ctx.strokeStyle = 'rgba(255,255,255,0.08)';
      ctx.lineWidth = 1;
      const ySteps = 4;
      const maxVal = Math.max(...values) * 1.15 || 1;
      for(let i=0;i<=ySteps;i++){
        const y = pad.top + ( (h-pad.top-pad.bottom) * i / ySteps );
        ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(w-pad.right, y); ctx.stroke();
      }

      ctx.fillStyle = 'rgba(203,213,225,0.9)';
      ctx.font = '12px system-ui';
      for(let i=0;i<=ySteps;i++){
        const val = Math.round(maxVal * (1 - i/ySteps));
        const y = pad.top + ( (h-pad.top-pad.bottom) * i / ySteps );
        ctx.fillText(val, 8, y+4);
      }

      const plotW = w - pad.left - pad.right;
      const plotH = h - pad.top - pad.bottom;
      labels.forEach((m, idx)=>{
        const x = pad.left + (plotW * idx / (labels.length-1));
        ctx.fillText(m, x-10, h-8);
      });

      ctx.beginPath();
      labels.forEach((_, idx)=>{
        const x = pad.left + (plotW * idx / (labels.length-1));
        const y = pad.top + plotH * (1 - values[idx]/maxVal);
        if(idx===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.strokeStyle = 'rgba(59,130,246,0.95)';
      ctx.lineWidth = 2;
      ctx.stroke();

      labels.forEach((_, idx)=>{
        const x = pad.left + (plotW * idx / (labels.length-1));
        const y = pad.top + plotH * (1 - values[idx]/maxVal);
        ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2);
        ctx.fillStyle = 'rgba(59,130,246,1)'; ctx.fill();
      });
    }

    /* Donut chart */
    const donutCanvas = document.getElementById('donutChart');
    const dctx = donutCanvas.getContext('2d');
    const donutDataBase = [
      { label:'add money', value:320 },
      { label:'withdraw', value:450 },
      { label:'send money', value:220 },
      { label:'request money', value:260 },
      { label:'Other', value:140 },
    ];
    const donutColors = ['#60a5fa', '#34d399', '#a78bfa', '#f59e0b', '#f472b6'];

    function drawDonut(data, base){
      donutCanvas.width = donutCanvas.clientWidth;
      donutCanvas.height = donutCanvas.clientHeight;
      dctx.clearRect(0,0,donutCanvas.width, donutCanvas.height);
      const total = data.reduce((s,x)=>s+x.value,0) || 1;
      const cx = donutCanvas.width/2, cy = donutCanvas.height/2, r = Math.min(cx,cy)-10, ir = r*0.6;

      let start = -Math.PI/2;
      data.forEach((seg, i)=>{
        const val = seg.value * (rates['USD'][base] || 1);
        const angle = (val / (total*(rates['USD'][base]||1))) * Math.PI*2;
        dctx.beginPath();
        dctx.moveTo(cx, cy);
        dctx.arc(cx, cy, r, start, start+angle);
        dctx.closePath();
        dctx.fillStyle = donutColors[i % donutColors.length];
        dctx.globalAlpha = 0.9;
        dctx.fill();
        start += angle;
      });

      dctx.globalCompositeOperation = 'destination-out';
      dctx.beginPath(); dctx.arc(cx, cy, ir, 0, Math.PI*2); dctx.fill();
      dctx.globalCompositeOperation = 'source-over';

      const legendX = 14, legendY = 18;
      dctx.font = '12px system-ui'; dctx.fillStyle = 'rgba(229,231,235,0.95)';
      data.forEach((seg, i)=>{
        dctx.fillStyle = donutColors[i % donutColors.length];
        dctx.globalAlpha = 0.9;
        dctx.fillRect(legendX, legendY + i*18, 10, 10);
        dctx.globalAlpha = 1;
        dctx.fillStyle = 'rgba(229,231,235,0.95)';
        dctx.fillText(`${seg.label}`, legendX+16, legendY+9 + i*18);
      });
    }

    /* Transactions (demo) */
    const txData = [
      {date:'2025-08-17', desc:'Groceries — Luna Mart', wallet:'USD', amount:-86.35, status:'Completed'},
      {date:'2025-08-16', desc:'Salary — August', wallet:'USD', amount:2400.00, status:'Completed'},
      {date:'2025-08-15', desc:'Netflix Subscription', wallet:'USD', amount:-9.99, status:'Completed'},
      {date:'2025-08-14', desc:'ATM Withdrawal', wallet:'EUR', amount:-120.00, status:'Completed'},
      {date:'2025-08-13', desc:'FX — USD→GBP', wallet:'USD', amount:-300.00, status:'Completed'},
      {date:'2025-08-12', desc:'Refund — Store #483', wallet:'USD', amount:21.50, status:'Completed'},
      {date:'2025-08-11', desc:'Uber Ride', wallet:'USD', amount:-7.40, status:'Completed'},
      {date:'2025-08-10', desc:'Electricity Bill', wallet:'GBP', amount:-68.20, status:'Pending'},
      {date:'2025-08-09', desc:'Restaurant — Oak Dine', wallet:'USD', amount:-42.10, status:'Completed'},
      {date:'2025-08-08', desc:'SAR Top-up', wallet:'SAR', amount:500.00, status:'Completed'},
      {date:'2025-08-07', desc:'Mobile Plan', wallet:'USD', amount:-15.00, status:'Completed'},
      {date:'2025-08-06', desc:'Gym Membership', wallet:'USD', amount:-25.00, status:'Completed'},
      {date:'2025-08-05', desc:'Payment — John Doe', wallet:'EUR', amount:-120.50, status:'Completed'},
      {date:'2025-08-04', desc:'Interest credit', wallet:'USD', amount:4.72, status:'Completed'},
      {date:'2025-08-03', desc:'FX — GBP→USD', wallet:'GBP', amount:-90.00, status:'Completed'},
      {date:'2025-08-02', desc:'Coffee — Brew Co', wallet:'USD', amount:-3.80, status:'Completed'},
    ];

    const pageSize = 8;
    let page = 1;
    let filtered = [...txData];

    const txBody = document.getElementById('txBody');
    const txSearch = document.getElementById('txSearch');
    const pageInfo = document.getElementById('pageInfo');
    const txCountLabel = document.getElementById('txCountLabel');
    const prevBtn = document.getElementById('prevPage');
    const nextBtn = document.getElementById('nextPage');
    const savedTags = document.getElementById('savedTags');
    const saveBtn = document.getElementById('saveFilter');

    const FILTER_KEY='txSavedFilters';

    function renderTable(){
      if(!txBody) return;
      const start = (page-1)*pageSize;
      const slice = filtered.slice(start, start+pageSize);
      if(slice.length===0){
        txBody.innerHTML = `<tr><td colspan="5" style="padding:18px 10px; text-align:center; color:#cbd5e1">No transactions</td></tr>`;
      }else{
        txBody.innerHTML = slice.map(r=>{
          const amtCls = r.amount >= 0 ? 'amount-pos' : 'amount-neg';
          const sign = r.amount >= 0 ? '+' : '';
          return `<tr>
            <td>${r.date}</td>
            <td>${r.desc}</td>
            <td>${r.wallet}</td>
            <td class="${amtCls}">${sign}${r.amount.toFixed(2)}</td>
            <td><span class="badge">${r.status}</span></td>
          </tr>`;
        }).join('');
      }
      const totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));
      pageInfo && (pageInfo.textContent = `Page ${page} of ${totalPages}`);
      if(prevBtn) prevBtn.disabled = page<=1;
      if(nextBtn) nextBtn.disabled = page>=totalPages;
      txCountLabel && (txCountLabel.textContent = `${filtered.length} items`);
    }

    function applySearch(q){
      filtered = txData.filter(r =>
        r.desc.toLowerCase().includes(q) ||
        r.status.toLowerCase().includes(q) ||
        r.wallet.toLowerCase().includes(q)
      );
      page = 1; renderTable();
    }

    function addFilterTag(text){
      const tag = document.createElement('button');
      tag.className='tag';
      tag.textContent = text + ' ✕';
      tag.addEventListener('click', ()=>{
        tag.remove();
        localStorage.setItem(FILTER_KEY, JSON.stringify([...document.querySelectorAll('#savedTags .tag')].map(t=>t.textContent.replace(' ✕',''))));
        applySearch(''); txSearch.value='';
      });
      savedTags.appendChild(tag);
    }

    function loadFiltersFromStorage(){
      try{
        const tags=JSON.parse(localStorage.getItem(FILTER_KEY)||'[]');
        tags.forEach(addFilterTag);
      }catch(_){}
    }

    txSearch && txSearch.addEventListener('input', ()=>{
      const q = txSearch.value.trim().toLowerCase();
      applySearch(q);
    });
    prevBtn && prevBtn.addEventListener('click', ()=>{ if(page>1){ page--; renderTable(); }});
    nextBtn && nextBtn.addEventListener('click', ()=>{
      const totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));
      if(page<totalPages){ page++; renderTable(); }
    });
    saveBtn && saveBtn.addEventListener('click', ()=>{
      const q = txSearch.value.trim();
      if(!q) return;
      addFilterTag(q);
      localStorage.setItem(FILTER_KEY, JSON.stringify([...document.querySelectorAll('#savedTags .tag')].map(t=>t.textContent.replace(' ✕',''))));
    });

    /* Quick Actions -> sheets */
    const btnSend=document.getElementById('qaSend');
    const btnWd=document.getElementById('qaWithdraw');
    const btnReq=document.getElementById('qaRequest');
    const btnAdd=document.getElementById('qaAdd');

    function openSheet(id){
      const el=document.getElementById(id); if(!el) return;
      el.style.display='grid';
      document.body.style.overflow='hidden';
    }
    function closeSheet(id){
      const el=document.getElementById(id); if(!el) return;
      el.style.display='none';
      document.body.style.overflow='';
    }
    function closeAllSheets(){
      ['sheet-send','sheet-withdraw','sheet-request','sheet-add'].forEach(closeSheet);
    }

    btnSend && btnSend.addEventListener('click', ()=> openSheet('sheet-send'));
    btnWd && btnWd.addEventListener('click', ()=> openSheet('sheet-withdraw'));
    btnReq && btnReq.addEventListener('click', ()=> openSheet('sheet-request'));
    btnAdd && btnAdd.addEventListener('click', ()=> openSheet('sheet-add'));

    document.querySelectorAll('.sheet').forEach(sheet=>{
      sheet.addEventListener('click', (e)=>{ if(e.target===sheet) closeAllSheets(); });
    });
    document.querySelectorAll('[data-close]').forEach(btn=>{
      btn.addEventListener('click', ()=> closeSheet(btn.getAttribute('data-close')));
    });

    const submitAndNotify = (title) => {
      pushNotif(title, 'Action queued (demo)');
      closeAllSheets();
    };
    document.getElementById('send-submit')?.addEventListener('click', ()=>submitAndNotify('Send money submitted'));
    document.getElementById('wd-submit')?.addEventListener('click', ()=>submitAndNotify('Withdraw submitted'));
    document.getElementById('rq-submit')?.addEventListener('click', ()=>{
      const id = (document.getElementById('rq-rec')?.value||'').trim();
      pushNotif('Payment request received', `From ID ${id}`, {action:'open-send', requesterId:id});
      closeAllSheets();
    });
    document.getElementById('ad-submit')?.addEventListener('click', ()=>submitAndNotify('Add money submitted'));

    /* World lists for withdraw */
    const WORLD_COUNTRIES = ['Bangladesh','India','United States','United Kingdom','Saudi Arabia','United Arab Emirates','Canada','Australia','Germany','France'];
    const COUNTRY_CITIES = {
      Bangladesh:['Dhaka','Chattogram','Khulna','Sylhet','Rajshahi'],
      India:['Mumbai','Delhi','Bengaluru','Kolkata','Chennai'],
      'United States':['New York','Los Angeles','Chicago','Houston','Miami'],
      'United Kingdom':['London','Birmingham','Manchester','Leeds','Glasgow'],
      'Saudi Arabia':['Riyadh','Jeddah','Dammam','Makkah','Madinah'],
      'United Arab Emirates':['Dubai','Abu Dhabi','Sharjah','Ajman'],
      Canada:['Toronto','Vancouver','Montreal','Calgary','Ottawa'],
      Australia:['Sydney','Melbourne','Brisbane','Perth','Adelaide'],
      Germany:['Berlin','Munich','Hamburg','Cologne','Frankfurt'],
      France:['Paris','Lyon','Marseille','Toulouse','Nice']
    };
    const WORLD_BANKS = [
      'Bangladesh Bank','Sonali Bank','BRAC Bank','Dutch-Bangla Bank','HSBC','Standard Chartered',
      'State Bank of India','HDFC Bank','ICICI Bank','Citibank','Bank of America','Chase',
      'Barclays','Lloyds','NatWest','Deutsche Bank','BNP Paribas','Riyad Bank','Al Rajhi Bank',
      'Emirates NBD','First Abu Dhabi Bank','Scotiabank','TD Bank','Commonwealth Bank'
    ];
    const WORLD_MFS = [
      'bKash','Nagad','Rocket','Upay','Paytm','PhonePe','Google Pay','M-Pesa','Orange Money',
      'JazzCash','Easypaisa','GCash','GrabPay','Alipay','WeChat Pay','STC Pay','Vodafone Cash'
    ];

    function populateSelect(sel, arr){
      if(!sel) return;
      sel.innerHTML = arr.map(v=>`<option value="${v}">${v}</option>`).join('');
    }

    function populateWithdrawData(){
      const countrySel = document.getElementById('wd-country');
      const citySel = document.getElementById('wd-city');
      const bankSel = document.getElementById('wd-bank');
      const mfsSel = document.getElementById('wd-mfs');

      populateSelect(countrySel, WORLD_COUNTRIES);
      populateSelect(bankSel, WORLD_BANKS);
      populateSelect(mfsSel, WORLD_MFS);

      function refreshCities(){
        const c = countrySel?.value || WORLD_COUNTRIES[0];
        const cities = COUNTRY_CITIES[c] || [];
        populateSelect(citySel, cities);
      }
      countrySel?.addEventListener('change', refreshCities);
      refreshCities();

      const methodSel = document.getElementById('wd-method');
      const bankBox = document.getElementById('wd-bank-fields');
      const mfsBox = document.getElementById('wd-mfs-fields');
      methodSel?.addEventListener('change', ()=>{
        const isBank = methodSel.value==='bank';
        bankBox.style.display = isBank?'block':'none';
        mfsBox.style.display = isBank?'none':'block';
      });
    }

    /* Fees (live) — Send 1.4%, Withdraw 2% */
    function calcPercent(amount, pct){ const a = parseFloat(amount||0); return isNaN(a)?0: +(a * pct / 100).toFixed(2); }
    function fmt(ccy, amt){ const n = Number(amt||0); return `${ccy} ${n.toFixed(2)}`; }

    function attachFeeHandlers(){
      // Send
      const sAmt = document.getElementById('send-amt');
      const sCcy = document.getElementById('send-ccy');
      const sLine = document.getElementById('send-fee-line');
      function updateSendFee(){
        const amt = parseFloat(sAmt?.value||0)||0;
        const ccy = sCcy?.value||'USD';
        const fee = calcPercent(amt, 1.4);
        const net = Math.max(0, amt - fee);
        sLine.textContent = `Fees: ${fmt(ccy, fee)} | Receiver gets: ${fmt(ccy, net)}`;
      }
      sAmt?.addEventListener('input', updateSendFee);
      sCcy?.addEventListener('change', updateSendFee);
      updateSendFee();

      // Withdraw
      const wAmt = document.getElementById('wd-amt');
      const wCcy = document.getElementById('wd-ccy');
      const wLine = document.getElementById('wd-fee-line');
      function updateWdFee(){
        const amt = parseFloat(wAmt?.value||0)||0;
        const ccy = wCcy?.value||'USD';
        const fee = calcPercent(amt, 2.0);
        const net = Math.max(0, amt - fee);
        wLine.textContent = `Fees: ${fmt(ccy, fee)} | You’ll receive: ${fmt(ccy, net)}`;
      }
      wAmt?.addEventListener('input', updateWdFee);
      wCcy?.addEventListener('change', updateWdFee);
      updateWdFee();
    }

    /* === NEW: Deposit & Withdraw History data + rendering (same design) === */
    const depData = [
      {date:'2025-08-17', ref:'STRP-948312', wallet:'USD', amount:500.00, status:'Completed'},
      {date:'2025-08-15', ref:'VISA-773201', wallet:'EUR', amount:220.00, status:'Completed'},
      {date:'2025-08-12', ref:'MC-552110',   wallet:'GBP', amount:150.50, status:'Pending'},
      {date:'2025-08-08', ref:'STRP-948199', wallet:'USD', amount:1000.00, status:'Completed'},
      {date:'2025-08-03', ref:'VISA-992331', wallet:'SAR', amount:300.00, status:'Failed'},
      {date:'2025-07-29', ref:'MC-118200',   wallet:'USD', amount:75.25,  status:'Completed'}
    ];
    const wdData = [
      {date:'2025-08-16', dest:'Bank — BRAC (Dhaka)', wallet:'USD', amount:-200.00, status:'Completed'},
      {date:'2025-08-13', dest:'bKash +8801xxxx',     wallet:'BDT', amount:-50.00,  status:'Completed'},
      {date:'2025-08-10', dest:'Bank — Chase (NYC)',  wallet:'USD', amount:-300.00, status:'Pending'},
      {date:'2025-08-06', dest:'Nagad +8801xxxx',     wallet:'BDT', amount:-40.00,  status:'Completed'},
      {date:'2025-08-01', dest:'Bank — HSBC (London)',wallet:'GBP', amount:-120.00, status:'Failed'}
    ];

    const depPageSize=6, wdPageSize=6;
    let depPage=1, wdPage=1;
    let depFiltered=[...depData], wdFiltered=[...wdData];

    const depBody=document.getElementById('depBody');
    const depSearch=document.getElementById('depSearch');
    const depPrev=document.getElementById('depPrev');
    const depNext=document.getElementById('depNext');
    const depInfo=document.getElementById('depPageInfo');
    const depCountLabel=document.getElementById('depCountLabel');

    const wdBody=document.getElementById('wdBody');
    const wdSearch=document.getElementById('wdSearch');
    const wdPrev=document.getElementById('wdPrev');
    const wdNext=document.getElementById('wdNext');
    const wdInfo=document.getElementById('wdPageInfo');
    const wdCountLabel=document.getElementById('wdCountLabel');

    function renderDepositTable(){
      if(!depBody) return;
      const start=(depPage-1)*depPageSize;
      const slice=depFiltered.slice(start, start+depPageSize);
      depBody.innerHTML = slice.length? slice.map(r=>{
        return `<tr>
          <td>${r.date}</td>
          <td>${r.ref}</td>
          <td>${r.wallet}</td>
          <td class="amount-pos">+${r.amount.toFixed(2)}</td>
          <td><span class="badge">${r.status}</span></td>
        </tr>`;
      }).join('') : `<tr><td colspan="5" style="padding:18px 10px; text-align:center; color:#cbd5e1">No deposits</td></tr>`;
      const totalPages=Math.max(1, Math.ceil(depFiltered.length/depPageSize));
      depInfo.textContent=`Page ${depPage} of ${totalPages}`;
      depPrev.disabled=depPage<=1; depNext.disabled=depPage>=totalPages;
      depCountLabel.textContent=`${depFiltered.length} items`;
    }
    function renderWithdrawTable(){
      if(!wdBody) return;
      const start=(wdPage-1)*wdPageSize;
      const slice=wdFiltered.slice(start, start+wdPageSize);
      wdBody.innerHTML = slice.length? slice.map(r=>{
        return `<tr>
          <td>${r.date}</td>
          <td>${r.dest}</td>
          <td>${r.wallet}</td>
          <td class="amount-neg">${r.amount.toFixed(2)}</td>
          <td><span class="badge">${r.status}</span></td>
        </tr>`;
      }).join('') : `<tr><td colspan="5" style="padding:18px 10px; text-align:center; color:#cbd5e1">No withdrawals</td></tr>`;
      const totalPages=Math.max(1, Math.ceil(wdFiltered.length/wdPageSize));
      wdInfo.textContent=`Page ${wdPage} of ${totalPages}`;
      wdPrev.disabled=wdPage<=1; wdNext.disabled=wdPage>=totalPages;
      wdCountLabel.textContent=`${wdFiltered.length} items`;
    }
    depSearch?.addEventListener('input', ()=>{
      const q=depSearch.value.trim().toLowerCase();
      depFiltered=depData.filter(r=> r.ref.toLowerCase().includes(q) || r.status.toLowerCase().includes(q) || r.wallet.toLowerCase().includes(q));
      depPage=1; renderDepositTable();
    });
    wdSearch?.addEventListener('input', ()=>{
      const q=wdSearch.value.trim().toLowerCase();
      wdFiltered=wdData.filter(r=> (r.dest||'').toLowerCase().includes(q) || r.status.toLowerCase().includes(q) || r.wallet.toLowerCase().includes(q));
      wdPage=1; renderWithdrawTable();
    });
    depPrev?.addEventListener('click', ()=>{ if(depPage>1){ depPage--; renderDepositTable(); }});
    depNext?.addEventListener('click', ()=>{
      const totalPages=Math.max(1, Math.ceil(depFiltered.length/depPageSize));
      if(depPage<totalPages){ depPage++; renderDepositTable(); }
    });
    wdPrev?.addEventListener('click', ()=>{ if(wdPage>1){ wdPage--; renderWithdrawTable(); }});
    wdNext?.addEventListener('click', ()=>{
      const totalPages=Math.max(1, Math.ceil(wdFiltered.length/wdPageSize));
      if(wdPage<totalPages){ wdPage++; renderWithdrawTable(); }
    });
    /* === /NEW === */

    /* Beneficiaries (demo) */
    const benefRow=document.getElementById('benefRow');
    const recentBenefs=['Arif Khan','Rupa Akter','Sadia Afreen','Tanvir Hasan','Mira Chowdhury','Shuvo Sarker'];
    if(benefRow){
      benefRow.innerHTML = recentBenefs.map(n=>{
        const initials = n.split(' ').map(s=>s[0]).join('').slice(0,2).toUpperCase();
        return `<div class="benef"><div class="av">${initials}</div><div><div class="name">${n}</div><div class="again">Send again</div></div></div>`;
      }).join('');
    }

    /* Charts & init */
function init(){
  updateWalletDisplays(ccySel.value);
  drawLineChart(months, scaleSeries(seriesBase, ccySel.value));
  drawDonut(donutDataBase, ccySel.value);

  // user id render
  const USER_ID_KEY = 'userId';
  const userId = localStorage.getItem(USER_ID_KEY) || '9876543210';
  const idEl = document.getElementById('userIdValue');
  if(idEl) idEl.textContent = userId;

  // tables render (pure render only)
  filtered = [...txData];
  page = 1;
  renderTable();

  renderDepositTable();
  renderWithdrawTable();
}

init();

populateWithdrawData();
attachFeeHandlers();
loadFiltersFromStorage();

function resizeCharts(){
  const base = (document.getElementById('ccy')?.value) || 'USD';
  drawLineChart(months, scaleSeries(seriesBase, base));
  drawDonut(donutDataBase, base);
}

let resizeTimer = null;
window.addEventListener('resize', ()=>{
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(resizeCharts, 120);
});

    /* Active nav highlight */
    (function syncActiveNav(){
      const map = {
        'overview.html':'navOverview',
        'wallet.html':'navWallet',
        'transactions.html':'navTx',
        'statistics.html':'navStats'
      };
      const path = (location.pathname.split('/').pop()||'overview.html').toLowerCase();
      const id = map[path] || 'navOverview';
      const link = document.getElementById(id);
      if(link){
        document.querySelectorAll('.dashboard-nav a').forEach(a=>a.classList.remove('active'));
        link.classList.add('active');
      }
    })();
  </script>
</body>
</html>
